# Переход на официальное Reddit API

## Что изменилось

### 1. Аутентификация
Теперь приложение использует официальное Reddit OAuth API вместо неофициальных JSON endpoints.

**Тип аутентификации**: Application-Only OAuth (не требует аутентификации пользователей)
- Подходит для отображения постов без входа пользователя в систему
- Использует Client Credentials Grant Flow

### 2. Структура проекта

#### Новые файлы:
- `src/services/redditAPI.js` - Сервис для работы с официальным Reddit API
- `netlify/functions/reddit-token.js` - Serverless функция для безопасного получения токенов

#### Изменённые файлы:
- `src/features/Subreddit/subredditSlice.js` - Обновлён для использования API сервиса
- `src/features/Comments/commentsSlice.js` - Обновлён для использования API сервиса  
- `src/features/SearchReddit/SearchReddit.js` - Обновлён для использования API сервиса
- `src/features/Comments/FullPostWithComments/FullPostWithComments.js` - Упрощён интерфейс

#### Удалённые файлы:
- `.env` и `.env.example` - Переменные окружения перенесены в Netlify

## Настройка

### 1. Регистрация приложения Reddit
1. Перейдите на https://www.reddit.com/prefs/apps
2. Нажмите "are you a developer? create an app..."
3. Выберите тип "web app"
4. Заполните необходимые поля
5. Получите Client ID и Client Secret

### 2. Настройка Netlify serverless функций
1. Разместите файл `netlify/functions/reddit-token.js` в проекте
2. В настройках Netlify добавьте переменные окружения:
   ```
   REDDIT_CLIENT_ID=ваш_client_id
   REDDIT_CLIENT_SECRET=ваш_client_secret  
   REDDIT_USER_AGENT=web:your-app-name:v1.0.0 (by /u/yourusername)
   ```
3. Отметьте их как "Secret" для безопасности
4. Разверните проект на Netlify

## Преимущества официального API

### 1. Надёжность
- Официально поддерживаемые endpoints
- Стабильная структура ответов
- Меньше вероятность внезапных изменений

### 2. Производительность
- Аутентифицированные запросы имеют более высокие лимиты
- 100 запросов в минуту (по сравнению с сильно ограниченным анонимным доступом)

### 3. Функциональность
- Доступ к дополнительным endpoints
- Лучшая обработка ошибок
- Официальная документация

### 4. Соответствие правилам
- Соответствие Terms of Service Reddit
- Правильная идентификация приложения через User-Agent
- Отслеживание использования API

## Rate Limits (Лимиты скорости)

Официальное API имеет лимиты:
- **100 запросов в минуту** для аутентифицированных приложений
- Лимиты усредняются за 10-минутное окно для поддержки всплесков запросов
- Мониторинг через response headers:
  - `X-Ratelimit-Used`: Использованные запросы  
  - `X-Ratelimit-Remaining`: Оставшиеся запросы
  - `X-Ratelimit-Reset`: Время до сброса

## API Endpoints

### Получение постов Subreddit
```javascript
await redditAPI.getSubredditPosts('javascript', { limit: 25 })
```

### Получение комментариев поста
```javascript  
await redditAPI.getPostComments('javascript', 'abc123', { limit: 50 })
```

### Поиск по Reddit
```javascript
await redditAPI.searchReddit('react hooks', { 
  limit: 25, 
  sort: 'relevance',
  time: 'all' 
})
```

## Безопасность

### Netlify serverless функции
- Client Secret хранится только в переменных окружения Netlify
- Токены получаются через serverless функцию `/.netlify/functions/reddit-token`
- Секреты никогда не попадают в клиентский код
- HTTPS соединение защищает все запросы

### Архитектура безопасности
```
Browser → Netlify Function → Reddit API
                ↑
           (secrets stored here)
```

### User-Agent
- Обязательное требование Reddit API
- Должен содержать название приложения и контакт разработчика
- Формат: `<platform>:<app ID>:<version string> (by /u/<reddit username>)`

## Устранение неполадок

### Ошибки аутентификации
- Проверьте правильность Client ID и Client Secret
- Убедитесь что приложение зарегистрировано как "web app"
- Проверьте формат User-Agent

### CORS ошибки  
- Reddit API правильно настроен для CORS
- Если возникают проблемы, проверьте URL endpoints

### Rate Limiting
- Мониторьте заголовки ответов для отслеживания лимитов
- Реализуйте задержки между запросами при необходимости

## Дальнейшие улучшения

### Возможные добавления:
1. **Кэширование токенов** - Сохранение токенов в localStorage
2. **Retry механизм** - Автоматический повтор при ошибках
3. **Пагинация** - Загрузка следующих страниц постов
4. **Фильтрация** - Дополнительные параметры поиска
5. **User Authentication** - Вход пользователей для персональных функций

### Мониторинг производительности:
- Отслеживание использования API лимитов
- Кэширование часто запрашиваемых данных
- Оптимизация количества запросов

## Заключение

Переход на официальное Reddit API делает ваше приложение более надёжным, производительным и соответствующим правилам платформы. Хотя требуется дополнительная настройка аутентификации, преимущества значительно перевешивают сложность внедрения.